! Codegen test module
MODULE test  =
BEGIN

LITERAL
    DSC$K_S_BLN     = 8;
MACRO
    DSC$W_LENGTH    = 0,0,16,0%,
    DSC$B_DTYPE     = 0,16,8,0%,
    DSC$B_CLASS     = 0,24,8,0%,
    DSC$A_POINTER   = 4,0,32,0%;
    
OWN
    testown : INITIAL (29),
    ch      : VECTOR [4,BYTE] INITIAL(%CHAR(%X'7F'),%CHAR(%X'EE'),
                                      %CHAR(%X'0A'), %CHAR(%x'0D'));
FORWARD ROUTINE test2;

ROUTINE testrtn (p1) =
BEGIN

LOCAL val;
val = (
SELECTONE .p1 OF
SET
    [1,3,5] : 1;
    [0,2,4] : 0;
    [OTHERWISE] : test2(10);
TES);

.val

END;

OWN farfel : INITIAL (0);
EXTERNAL ROUTINE DOPRINT : NOVALUE;

GLOBAL ROUTINE test2 (x,y) =
BEGIN

DOPRINT(.x);
DOPRINT(.y);

RETURN MIN(.x,.y);
END;

GLOBAL ROUTINE testme  =
BEGIN
    LOCAL
        dsc : BLOCK [DSC$K_S_BLN,BYTE]
                PRESET ([DSC$B_DTYPE] = 14,
                        [DSC$B_CLASS] = 2,
                        [DSC$W_LENGTH] = 32),
        buf : VECTOR [32,BYTE], ! INITIAL (1,2,3,4),
        hello,
        maxval;

    hello = PLIT(REP 37 OF (%STRING('abcde')));

    DECRU i FROM 77 BY 2 DO
    BEGIN
        hello = .hello + .i;
    END;
    
    farfel = hello + SIGN(.buf[0]);
    maxval = MAXU(.farfel, .buf[1], .buf[2]);
    
    testrtn(.maxval)
    
END;

END
ELUDOM
